<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todolist</title>
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"></script>

    <style>
        .select
        {
            padding: 4px 10px;
            text-align: center;
            background-color: white;
            color: black;
            border: 2px solid grey;
            border-radius:5px;
        }

        .button
        {
            -webkit-transition-duration: 0.4s;
            transition-duration: 0.4s;
            padding: 4px 10px;
            text-align: center;
            background-color: white;
            color: black;
            border: 2px solid grey;
            border-radius:5px;
        }

        .button:hover
        {
            background-color: grey;
            color: white;
        }

    </style>
</head>
<body>
    <!-- title -->
    <div id="title"></div>

    <!-- functions -->
    <div id="funcpanel"></div>

    <!-- show the list-->
    <table border="1" bgcolor="white" frame="void" rules="rows" width="100%">
        <tr><th></th></tr>

        {% for item in todolist %}
            <tr>
                <td>
                    <div id="item{{ item.id }}"></div>
                    <script type="text/babel">
                        class Status extends React.Component{
                            render() {
                                if (this.props.status==0) {
                                    //change status
                                    return (
                                        <form name="status" action="/todolist/status" method="POST">
                                            <input type="hidden" name="id" value={this.props.id}  />
                                            <label>Status: Pending</label>
                                            <button class="button" type="submit">âˆš</button>
                                        </form>
                                    );
                                }
                                else {
                                    return (
                                        <div>
                                            <label>Status: Complete</label><br />
                                        </div>
                                    );
                                }
                            }
                        };

                        class Priority extends React.Component{
                            render() {
                                if (this.props.priority==1) {
                                    return (
                                        <div>
                                            <label>Priority: Low</label><br />
                                        </div>
                                    );
                                }
                                else {
                                    return (
                                        <div>
                                            <label>Priority: High</label><br />
                                        </div>
                                    );
                                }
                            }
                        };

                        class Item extends React.Component {
                            constructor(props) {
                                super(props);
                                this.state = {edit: false};
                            }

                            handleEditClick() { this.setState({edit: true}); }
                            handleCancelClick() { this.setState({edit: false}); }

                            render() {
                                const edit = this.state.edit;
                                let button;

                                if (edit) {
                                    button = <CancelButton onClick={this.handleCancelClick.bind(this)} />;
                                }
                                else {
                                    button = <EditButton onClick={this.handleEditClick.bind(this)} />;
                                }

                                return (
                                    <div>
                                        {button}
                                        <Switch
                                            edit={edit}
                                            id={this.props.id}
                                            name={this.props.name}
                                            content={this.props.content}
                                            expire_date={this.props.expire_date}
                                            status={this.props.status}
                                            priority={this.props.priority}
                                        />
                                    </div>
                                );
                            }
                        }

                        function EditButton(props) {
                            return (
                                <button class="button" onClick={props.onClick}>
                                    Edit
                                </button>
                            );
                        }

                        function CancelButton(props) {
                            return (
                                <button class="button" onClick={props.onClick}>
                                    Cancel
                                </button>
                            );
                        }

                        function Edit(props) {
                            return (
                                <div>
                                    <form name="add" action="/todolist/edit" method="post">
                                        <input type="hidden" name="id" value={props.id} />
                                        Name:<br />
                                        <input name="name" value={props.name} /><br />
                                        Content:<br />
                                        <input name="content" value={props.content} /><br />
                                        Expire Date:<br />
                                        <input type="date" name="expire_date" value={props.expire_date} /><br />
                                        Status:
                                        <select class="select" name="status">
                                            <option value="0" selected>Pending</option>
                                            <option value="1">Complete</option>
                                        </select><br />
                                        Priority:
                                        <select class="select" name="priority">
                                            <option value="1" selected>Low</option>
                                            <option value="2">High</option>
                                        </select><br />
                                        <button class="button" type="submit">Submit</button><br />
                                        <br />
                                    </form>
                                </div>
                            );
                        }

                        function Origin(props) {
                            return (
                                <div>
                                    <label>Name: {props.name}</label><br />
                                    <label>Content: {props.content}</label><br />
                                    <label>Expire Date: {props.expire_date}</label><br />
                                    <Status status={props.status} id={props.id} />
                                    <Priority priority={props.priority} />

                                    <form name="delete" action="/todolist/delete" method="POST">
                                        <input type="hidden" name="id" value={props.id} />
                                        <button class="button" type="submit">Delete</button><br />
                                    </form>
                                </div>
                            );
                        }

                        //enable edit
                        function Switch(props) {
                            const edit = props.edit;
                            if (edit) {
                                return (
                                    <Edit
                                        id={props.id}
                                        name={props.name}
                                        content={props.content}
                                        expire_date={props.expire_date}
                                        status={props.status}
                                        priority={props.priority}
                                    />
                                );
                            }
                            return (
                                <Origin
                                    id={props.id}
                                    name={props.name}
                                    content={props.content}
                                    expire_date={props.expire_date}
                                    status={props.status}
                                    priority={props.priority}
                                />
                            );
                        }

                        //one item
                        ReactDOM.render(
                            <Item
                                id="{{ item.id }}"
                                name="{{ item.name }}"
                                content="{{ item.content }}"
                                expire_date="{{ item.expire_date }}"
                                status="{{ item.status }}"
                                priority="{{ item.priority }}"
                            />,
                            document.getElementById('item'+{{ item.id }})
                        );
                    </script>
                </td>
            </tr>
        {% endfor %}
    </table>

</body>
</html>


<script type="text/babel">
    //title
    ReactDOM.render
    (
        <h1>Todolist</h1>,
        document.getElementById('title')
    );


    //add an item
    class AddPanel extends React.Component{
        render() {
            return (
                <form name="add" action="/todolist/add" method="post">
                    Name:<br />
                    <input name="name" /><br />
                    Content:<br />
                    <input name="content" /><br />
                    Expire Date:<br />
                    <input type="date" name="expire_date" /><br />
                    Priority:
                    <select class="select" name="priority">
                        <option value="1" selected>Low</option>
                        <option value="2">High</option>
                    </select><br />
                    <button class="button" type="submit">Add</button>
                </form>
            );
        }
    };

    //order
    class OrderPanel extends React.Component{
        render() {
            return (
                <form name="order" action="/todolist/" method="post">
                    <select class="select" name="seq">
                        <option value="0" selected>Time Created</option>
                        <option value="1">Priority</option>
                        <option value="2">Expire Date</option>
                    </select>
                    <button class="button" type="submit">Order</button><br />
                </form>
            );
        }
    }

    //function panel
    ReactDOM.render(
        <div>
            <AddPanel />
            <br />
            <OrderPanel />
            <br />
        </div>,
        document.getElementById('funcpanel')
    );
</script>